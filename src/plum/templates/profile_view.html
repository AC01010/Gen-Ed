{% extends "base.html" %}

{% block body %}
<style type="text/css">
dl.profile { display: grid; grid-template-columns: minmax(6em, max-content) 1fr; gap: 1em; }
dl.profile dt { font-weight: bold; text-align: right; }
dl.profile dd { margin: 0; }
</style>

<section class="section">
  <div class="container content is-size-5">
    <h1 class="title">Your Profile</h1>
    <dl class="profile">
      {% if user.full_name %}
        <dt>Full Name:</dt>
        <dd>{{ user.full_name }}</dd>
      {% endif %}
      {% if user.email %}
        <dt>Email:</dt>
        <dd>{{ user.email }}</dd>
      {% endif %}
      {% if user.auth_name %}
        <dt>{{ user.provider_name | title }} username:</dt>
        <dd>{{ user.auth_name }}</dd>
      {% endif %}
      {% if user.is_admin %}
        <dt></dt>
        <dd class="icon-text has-text-danger">
          <span class="icon">
            <svg aria-hidden="true"><use href="#svg_admin"></svg>
          </span>
          <span>Admin</span>
        </dd>
      {% endif %}
      {% if user.is_tester %}
        <dt></dt>
        <dd class="icon-text has-text-success">
          <span class="icon">
            <svg aria-hidden="true"><use href="#svg_flask"></svg>
          </span>
          <span>Tester</span>
        </dd>
      {% endif %}
      <dt>Queries:</dt>
      <dd>{{ user.num_queries }} total, {{ user.num_recent_queries }} in the past week.</dd>
      {% if not auth['role'] %}
      <dt>Tokens:</dt>
      <dd>{{ user.query_tokens }} remaining.  <span class="ml-3 is-size-6 has-text-grey">(These are just for trying out {{ config['APPLICATION_TITLE'] }} -- each query will use one.  They are only used when you do not have a class active.)</span></dd>
      {% endif %}
    </dl>
    <h2 class="title is-size-3">Classes</h1>
    <dl class="profile">
      <dt>Current:</dt>
      {% if auth['role'] %}
        <dd>{{ auth['class_name'] }} ({{ auth['role'] }})</dd>
      {% else %}
        <dd>None active.</dd>
      {% endif %}

      {% if other_classes %}
        <dt>Other:</dt>
        <dd>
          {% for class in other_classes %}
          <p>
            {{ class.name }} ({{ class.role }})
            <a href="{{ url_for("classes.switch_class_handler", class_id=class.id) }}" class="button is-link is-small is-rounded ml-3" style="vertical-align: center;">
              Switch to &uarr;
            </a>
          </p>
          {% endfor %}
        </dd>
      {% endif %}
      {% if user.provider_name not in ['lti', 'demo'] %}
        <dt></dt><dd>
          <button class="button is-success has-text-dark" onclick="document.querySelector('#new_class_dialog').showModal()">âž• Create new class</button>
        </dd>
      {% endif %}
    </dl>

    <dialog id="new_class_dialog" style="border: none; background: none; width: 75%; min-width: min(32em, 100vw);">
      <div class="content box">
        <h2>Create a New Class</h2>
        <p>You can create a class, attach an OpenAI API key to it, and invite others to join it as students.  You will be given the 'instructor' role in the class, and you will be able to configure it, control access and registration, and see all queries from students who join.</p>
        <form action="{{url_for('classes.create_class')}}" method="post">
          <div class="field">
            <label class="label is-size-5" for="class_name">Class Name:</label>
            <div class="control">
              <input class="input" required name="class_name" id="class_name">
            </div>
          </div>
          <div class="field">
            <label class="label is-size-5" for="openai_key">OpenAI API Key:</label>
            <div class="control">
              <input class="input" required name="openai_key" id="openai_key">
            </div>
          </div>
          <div class="field">
            <div class="control">
              <button class="button is-link" type="submit" >Submit</button>
            </div>
          </div>
        <form>
      </div>
    </dialog>
    <script type="text/JavaScript">
      // close dialog on click outside
      const dialog = document.querySelector("#new_class_dialog");
      dialog.addEventListener('click', function (e) {
          const rect = dialog.getBoundingClientRect();
          const isInDialog=(rect.top <= e.clientY && e.clientY <= rect.top + rect.height
            && rect.left <= e.clientX && e.clientX <= rect.left + rect.width);
          if (!isInDialog) {
              dialog.close();
          }
      });
    </script>
  </div>
</section>
{% endblock %}
