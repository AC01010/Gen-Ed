{% extends "base.html" %}
{% from "tables.html" import datatable %}

{% block body %}
{% set cur_filter_string = "?" + (filters.dict() | urlencode | safe) + ("&" | safe) %}
<section class="section">
  <div class="buttons is-inline">
    {% for filter in filters %}
      <a class="button is-info is-rounded p-3" href="?{{ filters.dict_minus(filter.name) | urlencode }}">
        {{filter.name}} = {{filter.value}}
        <span class="delete is-small is-link ml-2"></span>
      </a>
    {% endfor %}
  </div>
  <div class="columns is-multiline is-desktop">
    <div class="column is-7-desktop is-4-fullhd">
      <h1 class="is-size-3">Consumers <a class="button is-light is-link is-small mt-2" href="{{url_for('admin.consumer_form')}}">Create New</a></h1>
      {{ datatable('consumers', [('id', 'id'), ('consumer', 'lti_consumer'), ('#queries', 'num_queries')], consumers, link_col=0, link_template=cur_filter_string + "consumer=${value}", edit_link="consumer/") }}
      <h1 class="is-size-3">Classes</h1>
      {{ datatable('classes', [('id', 'id'), ('name', 'lti_context_label'), ('consumer', 'lti_consumer'), ('lti_id', 'lti_context_id'), ('#queries', 'num_queries')], classes, link_col=0, link_template=cur_filter_string + "class=${value}") }}
      <h1 class="is-size-3">Users</h1>
      {{ datatable('users', [('id', 'id'), ('user', 'username'), ('lti_id', 'lti_id'), ('#queries', 'num_queries')], users, link_col=1, link_template=cur_filter_string + "user=${value}") }}
      <h1 class="is-size-3">Roles</h1>
      {{ datatable('roles', [('id', 'id'), ('user', 'username'), ('class_id', 'class_id'), ('role', 'role'), ('#queries', 'num_queries')], roles, link_col=0, link_template=cur_filter_string + "role=${value}") }}
    </div>
    <div class="column is-full-widescreen is-8-fullhd">
      <h1 class="is-size-3">
        Queries
      </h1>
      {% block admin_queries %}
      {% endblock %}
    </div>
  </div>
</section>
<section class="section">
  <a href="get_db">Download DB</a>
</section>
{% endblock %}
