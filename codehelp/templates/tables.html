{% macro datatable(name, columns, data, link_col=None, link_template=None) -%}
  <table id="tbl_{{name}}">
    <thead>
      {% for col in columns %}
        <th>{{ col[0] }}</th>
      {% endfor %}
    </thead>
    <tbody>
      {% for row in data %}
        <tr>
          {% for col in columns %}
            {% set value = row[col[1]] %}
            {% if 'time' in col[1] %}
              {% set value = value | localtime %}
              <td>{{ value.strftime("%Y-%m-%d %-I:%M%P") }}</td>
            {% elif value | string | length > 30 %}
              <td><span title="{{value.replace('\n', ' ')}}">{{ value | truncate(30) }}</span></td>
            {% else %}
              <td>{{ value }}</td>
            {% endif %}
          {% endfor %}
      {% endfor %}
    </tbody>
  </table>
  <script type="text/javascript">
    const {{name}}table = new simpleDatatables.DataTable("table#tbl_{{name}}", {
      perPage: 20,
      perPageSelect: [[10, 10], [20, 20], [50, 50], ["All", 0]],
      template: options => `
<div class='${options.classes.container}'${options.scrollY.length ? ` style='height: ${options.scrollY}; overflow-Y: auto;'` : ""}></div>
<div class='${options.classes.bottom}'>
${ options.paging && options.perPageSelect ?
    `<div class='${options.classes.dropdown}'>
        <label>
            <select class='${options.classes.selector}'></select> ${options.labels.perPage}
        </label>
    </div>` :
    ""
}
${ options.paging ? `<div class='${options.classes.info}'></div>` : "" }
<nav class='${options.classes.pagination}'></nav>
${ options.searchable ?
    `<div class='${options.classes.search}'>
        <input class='${options.classes.input}' placeholder='${options.labels.placeholder}' type='text' size='7'>
    </div>` :
    ""
}
</div>`,
    });
    {{name}}table.on("datatable.selectrow", (row, event) => {
      if (event.button == 2) {
        // right click -- don't trigger anything
        return;
      }
      const value = {{name}}table.data.data[row][{{link_col}}].text;
      window.location = `{{link_template}}`;
    });
  </script>
{%- endmacro %}
