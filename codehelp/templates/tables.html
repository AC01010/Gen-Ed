{% macro datatable(name, columns, data, link_col=None, link_template=None) -%}
  <table id="tbl_{{name}}">
    <thead>
      {% for col in columns %}
        <th>{{ col[0] }}</th>
      {% endfor %}
    </thead>
    <tbody>
      {% for row in data %}
        <tr>
          {% for col in columns %}
            {% set value = row[col[1]] %}
            {% if 'time' in col[1] %}
              {% set value = value | localtime %}
              <td>{{ value.strftime("%Y-%m-%d %-I:%M%P") }}</td>
            {% elif value | string | length > 30 %}
              {% set title_value = value.strip() | replace("\r", "") | replace("\n", "&#13;" | safe) %}
              <td><span title="{{ title_value }}">{{ value | truncate(30) }}</span></td>
            {% else %}
              <td>{{ value }}</td>
            {% endif %}
          {% endfor %}
      {% endfor %}
    </tbody>
  </table>
  <script type="text/javascript">
    initTable("tbl_{{name}}", {{link_col}}, value => `{{link_template}}`);
  </script>
{%- endmacro %}
